cmake_minimum_required(VERSION 3.22)
project(pitchEnginePro VERSION 1.0.0)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# JUCE
add_subdirectory(../JUCE ${CMAKE_CURRENT_BINARY_DIR}/JUCE)

juce_add_plugin(pitchEnginePro
    COMPANY_NAME "YCmp"
    BUNDLE_ID    com.ycmp.pitchenginepro
    IS_SYNTH     FALSE
    NEEDS_MIDI_INPUT FALSE
    NEEDS_MIDI_OUTPUT FALSE
    IS_MIDI_EFFECT FALSE
    COPY_PLUGIN_AFTER_BUILD TRUE
    PLUGIN_MANUFACTURER_CODE YCmp
    PLUGIN_CODE pEng
    FORMATS VST3 AU AAX
    PRODUCT_NAME "pitchEngine Pro"
)

# Resources: embed LUT JSON and icons
juce_add_binary_data(pitchEngine_Resources SOURCES
    resources/zlut/pitchEngine_zLUT_ref48k.json
    resources/icons/appIcon.png
)

# --- include only pitchEngine files (no SharedCode deps) ---
target_sources(pitchEnginePro PRIVATE
    source/PluginProcessor.cpp
    source/PluginEditor.cpp

    # Only the minimal DSP files that exist and compile cleanly
    source/dsp/PitchTracker.cpp
    source/dsp/Shifter.cpp
    source/dsp/Snapper.cpp
    source/dsp/Analyzer.cpp
    source/dsp/ZPlaneStyle.cpp
)

target_include_directories(pitchEnginePro PRIVATE
    source
    source/dsp
    source/util
    source/ui
    ../
)

target_link_libraries(pitchEnginePro PRIVATE
    pitchEngine_Resources
    juce::juce_audio_utils
    juce::juce_dsp
    juce::juce_audio_processors
    juce::juce_audio_devices
    juce::juce_core
    juce::juce_data_structures
    juce::juce_graphics
    juce::juce_gui_extra
    juce::juce_audio_basics
)

# JUCE / VST3 config - kill problematic features
target_compile_definitions(pitchEnginePro PRIVATE
    JUCE_WEB_BROWSER=0
    JUCE_USE_CURL=0
    JUCE_VST3_CAN_REPLACE_VST2=0
    JUCE_DISPLAY_SPLASH_SCREEN=0
    JUCE_REPORT_APP_USAGE=0
)

# Warnings
if(MSVC)
  target_compile_options(pitchEnginePro PRIVATE /W3 /permissive- /bigobj)
else()
  target_compile_options(pitchEnginePro PRIVATE -Wall -Wextra -Wpedantic)
endif()

# Clean output
set_target_properties(pitchEnginePro PROPERTIES
    RUNTIME_OUTPUT_DIRECTORY_RELEASE "${CMAKE_CURRENT_BINARY_DIR}/Release"
    LIBRARY_OUTPUT_DIRECTORY_RELEASE "${CMAKE_CURRENT_BINARY_DIR}/Release"
)